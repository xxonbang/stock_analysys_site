# 종목 검색 기능 분석 및 개선

## 현재 구현 상태

### 1. 하드코딩된 매핑 (약 28개 종목)
**위치**: `lib/korea-stock-mapper.ts`

**포함된 종목**:
- 삼성전자, SK하이닉스, NAVER, 카카오
- LG전자, LG화학, LG생활건강
- 현대차, 기아, POSCO
- 셀트리온, 아모레퍼시픽
- KB금융, 신한지주, 하나금융지주
- 삼성SDI, 한화솔루션, 롯데케미칼
- CJ제일제당, 한진, 일동제약
- 등 총 28개

**특징**:
- ✅ 빠른 검색 (즉시 반환)
- ✅ 확실한 결과 (하드코딩되어 있음)
- ❌ 제한적 (28개 종목만)

### 2. 동적 매핑 (전체 종목)
**위치**: `lib/korea-stock-mapper-dynamic.ts`

**데이터 소스**:
- FinanceDataReader StockListing API
- GitHub 백업 CSV (Fallback)
- 캐시 파일 (24시간 TTL)

**특징**:
- ✅ 전체 종목 검색 가능 (수천 개)
- ⚠️ Python 스크립트 실행 필요
- ⚠️ API 실패 시 빈 결과 가능

## 검색 로직 개선 사항

### 수정 전 문제점
1. "LG" 검색 시 결과 없음
   - 원인: 대소문자 구분 및 한글/영문 혼합 처리 미흡
2. "엘지" 검색 시 결과 없음
   - 원인: "엘지" → "LG" 변환 로직 없음
3. 부분 매칭이 제대로 작동하지 않음

### 수정 후 개선 사항
1. **검색어 정규화 강화**
   ```typescript
   const normalizedQuery = trimmedQuery
     .toLowerCase()           // 대소문자 무시
     .replace(/\s+/g, '')     // 공백 제거
     .replace(/엘지/g, 'lg')  // "엘지" → "lg" 변환
     .replace(/엘/g, 'lg');   // "엘" → "lg" 변환
   ```

2. **부분 매칭 로직 개선**
   - `includes()`: 검색어가 이름에 포함되는지 확인
   - `startsWith()`: 이름이 검색어로 시작하는지 확인
   - "LG" → "lg전자", "lg화학", "lg생활건강" 매칭
   - "엘지" → "lg전자" 등 매칭 (정규화 후)

3. **검색 우선순위**
   1. 하드코딩 매핑 정확 매칭
   2. 하드코딩 매핑 부분 매칭
   3. 동적 매핑 정확 매칭
   4. 동적 매핑 부분 매칭

## 테스트 케이스

### ✅ 작동해야 하는 검색어
- "삼성전" → 삼성전자
- "삼성" → 삼성전자, 삼성SDI
- "LG" → LG전자, LG화학, LG생활건강
- "엘지" → LG전자, LG화학, LG생활건강
- "lg" → LG전자, LG화학, LG생활건강
- "005930" → 삼성전자
- "카카오" → 카카오

### ⚠️ 제한사항
- 하드코딩 매핑에 없는 종목은 동적 매핑에 의존
- 동적 매핑 실패 시 결과 없을 수 있음
- 전체 종목 검색을 위해서는 동적 매핑이 필수

## 개선 권장 사항

### 단기 개선
1. ✅ "LG", "엘지" 검색 지원 (완료)
2. ✅ 부분 매칭 로직 개선 (완료)

### 중기 개선
1. 하드코딩 매핑 확장 (인기 종목 100개 정도)
2. 동적 매핑 실패 시 더 나은 Fallback
3. 검색 결과 캐싱 (같은 검색어 반복 검색 시)

### 장기 개선
1. 검색 인덱스 구축 (더 빠른 검색)
2. 오타 교정 기능
3. 검색 히스토리 저장
